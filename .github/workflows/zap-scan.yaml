---
# This workflow will run the OWASP ZAP web application security scanner against
# the IDVA API Gateway

name: Zap-Scan

on:
  workflow_run:
    workflows: ["Deploy"]
    branches: [main]
    types: [completed]

jobs:
  zap_scan_api:
    if: github.repository_owner == '18F'
    runs-on: ubuntu-latest
    name: Scan the API Gateway - API
    steps:
      - uses: actions/checkout@v2

      - name: ZAP Scan (api)
        uses: zaproxy/action-full-scan@v0.3.0
        with:
          target: "https://idva-api-dev.app.cloud.gov"
          rules_file_name: ".zap/rules.tsv"

  zap_scan_sdk:
    if: github.repository_owner == '18F'
    runs-on: ubuntu-latest
    name: Scan the API Gateway - SDK
    steps:
      - uses: actions/checkout@v2

      - name: ZAP Scan (sdk)
        uses: zaproxy/action-full-scan@v0.3.0
        with:
          target: "https://idva-sdk-dev.app.cloud.gov"
          rules_file_name: ".zap/rules.tsv"

  zap_scan_portal:
    if: github.repository_owner == '18F'
    runs-on: ubuntu-latest
    name: Scan the API Gateway - Portal
    steps:
      - uses: actions/checkout@v2

      - name: ZAP Scan (portal)
        uses: zaproxy/action-full-scan@v0.3.0
        with:
          target: "https://idva-portal-dev.app.cloud.gov"
          rules_file_name: ".zap/rules.tsv"
